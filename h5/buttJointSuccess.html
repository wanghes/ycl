<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>线索详情</title>
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
	<script src="js/jquery.1.11.3.min.js"></script>
	<script src="js/common.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
	<div class="detailsContent">
		
		<div class="subTitle">
			<h3>发布线索流程</h3>
			<span></span>
		</div>
		
		<div class="detailsStatus" id="detailsStatus">
			<div><span>对接状态：</span>对接成功</div>
			<div><span>实际合同金额：</span><strong>￥1000.00</strong></div>
			<div><span>实际提成比例：</span><em>10%</em></div>
		</div>
		
		<div class="detailsSum">
			<p>我的上级：</p>
			<div><img id="upperImg" src="images/img1.jpg" alt="" /><span id="nickName">昵称</span><div id="percentageMoney">提成金额：￥100.00</div></div>
		</div>
		<div class="detailsStatus">
			<div><span>我的分销金额：</span><strong id="assignSaleMoney">￥1000.00</strong></div>
		</div>
		
		
		<div id="transformImg" class="mt_76">
			<div class="subTitle">
				<h3>商务对接人信息</h3>
				<span></span>
			</div>
			<dl id="dockerBox">
				<dd><span>对接人姓名：</span><div>张玉</div></dd>
				<dd><span>联系电话：</span><div>15733223355</div></dd>
				<dd><span>微信号码：</span><div>zai123456</div></dd>
				<dd><span>微信昵称：</span><div>不忘初心</div></dd>
				<dd><span>微信头像：</span><div><img src="images/img1.jpg" alt="" /></div></dd>
			</dl>
		</div>
		
		<div class="m-img-tip"><img src="images/3-7cabcun.png"/></div>
		
		<div class="subTitle">
			<h3>线索基本信息</h3>
			<span></span>
		</div>
		
		<div class="detailsDl" id="cluesBox">
			<dl>
				<dd><span>发布时间：</span><div>2017-12-21 12:30</div></dd>
				<dd><span>项目名称：</span><div>ERP系统设计</div></dd>
				<dd><span>业务类型：</span><div>人力外派</div></dd>
				<dd><span>行&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;业：</span><div>教育</div></dd>
				<dd><span>项目预算：</span><div>￥100000.00</div></dd>
				<dd><span>期望提成比例：</span><div>10%</div></dd>
				<dd><span>项目描述：</span><div>描述文字描述文字描述文字描述文字描述文字描述文字描述文字描述文字</div></dd>
			</dl>
		</div>
		
	</div>
	<script type="text/javascript">
		
			//对象化查询参数
			function GetRequest() {
				var url = location.search; //获取url中"?"符后的字串
				var theRequest = new Object();

				if (url.indexOf("?") != -1) {
				  	var str = url.substr(1);
				  		strs = str.split("&");
				  	for(var i = 0; i < strs.length; i ++) {
				   		theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
				  	}
				}
				return theRequest;
			}


			function createDetailsStatus(data){
				var detailsStatus = $('#detailsStatus');
				$('#assignSaleMoney').text('￥'+data.Commission_money);
				$('#percentageMoney').text('提成金额：￥'+data.proportion_money);
				$('#upperImg').attr('src',data.avator);
				$('#nickName').text(data.upname);
				detailsStatus.html = [
					'<div><span>对接状态：</span>对接成功</div>',
					'<div><span>实际合同金额：</span><strong>￥'+data.actual_budget+'</strong></div>',
					'<div><span>实际提成比例：</span><em>'+data.actual_proportion+'%</em></div>'
				].join('');
			}

			function createCluesHtml(clues){
				var cluesBox = $('#cluesBox');
				clues.addtime = clues.addtime.slice(0,-3);
				clues.cate_name = clues.cate_name.join(',');
				if(!isNaN(clues.budget)){
    				clues.budget = '￥'+clues.budget
    			}
				var html = [
					'<dd><span>发布时间：</span><div>'+clues.addtime+'</div></dd>',
					'<dd><span>项目名称：</span><div>'+clues.projectname+'</div></dd>',
					'<dd><span>业务类型：</span><div>'+clues.BusinessName+'</div></dd>',
					'<dd><span>行&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;业：</span><div>'+clues.cate_name+'</div></dd>',
					'<dd><span>项目预算：</span><div>'+clues.budget+'</div></dd>',
					'<dd><span>期望提成比例：</span><div>'+clues.proportion+'%</div></dd>',
					'<dd><span>项目描述：</span><div>'+clues.describes+'</div></dd>'
				].join('');
				cluesBox.html(html);
			}

			function createDockerHtml(docker){
				var dockerBox = $('#dockerBox');
				var html = [
					'<dd><span>对接人姓名：</span><div>'+docker.realname+'</div></dd>',
					'<dd><span>联系电话：</span><div>'+docker.username+'</div></dd>',
					'<dd><span>微信号码：</span><div>'+docker.wxnumber+'</div></dd>',
					'<dd><span>微信昵称：</span><div>'+docker.wxname+'</div></dd>',
					'<dd><span>微信头像：</span><div><img src="'+docker.avator+'" alt="" /></div></dd>'
				].join('');
				dockerBox.html(html);
			}

			$.ajax({
		        url: 'http://yichuanglian.huimor.com/index/DetailMessage',
		        type:'POST',
		        dataType:'json',
		        xhrFields:{  
					withCredentials:true  
				},
				data:GetRequest(),
		        success:function(data){
		        	if(data.code==1){
		        		var data = data.data;
		        		var docker = data.docker; //对接人信息
		        		var clues = data.clues; //线索基本信息
		        		var detailData = {
		        			actual_proportion:data.actual_proportion,
		        			actual_budget:data.actual_budget,
		        			proportion_money:data.proportion_money,
		        			Commission_money:data.Commission_money,
		        			upname:docker.upname,
		        			avator:docker.upimage,
		        		}
		        		createDetailsStatus(detailData);
		        		createCluesHtml(clues);
		        		createDockerHtml(docker);
		        	}else{
        		      	$.toastTip({
							img:'images/4-3gxfkui.png',
							imgW:'1.56rem',
							imgH:'1.5rem',
							text:[data.msg]
						});
		        	}
		        	
		        }
			});

		</script>
	</body>
</html>
