<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>已支付资金流水</title>
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<script src="js/jquery.1.11.3.min.js"></script>
		<script src="js/myAlert.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/common.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<div class="tab_div">
			<div class="active" data-id="first">我发布的线索分销明细</div>
			<div data-id="second">下级发布线索分销明细</div>
		</div>
		<div id="first" class="model" style="display: block;">
			<!-- <div class="list paylist">
				<div><span>项目名称111</span><span class="fr">成单时间：2017-12-21 12:39</span></div>
				<div><span>实际合同：￥1000.00</span></div>
				<div><span>总收入：￥1000.00</span></div>
				<div><span>已支付：￥1000.00</span></div>
			</div>
			<div class="list paylist">
				<div><span>ERP系统设计</span><span class="fr">成单时间：2017-12-21 12:39</span></div>
				<div><span>实际合同：￥1000.00</span></div>
				<div><span>总收入：￥1000.00</span></div>
				<div><span>已支付：￥1000.00</span></div>
			</div>
			<div class="list paylist">
				<div><span>ERP系统设计</span><span class="fr">成单时间：2017-12-21 12:39</span></div>
				<div><span>实际合同：￥500.00</span></div>
				<div><span>总收入：￥500.00</span></div>
				<div><span>已支付：￥500.00</span></div>
			</div> -->
		</div>
		<div id="second" class="model">
			<!-- <div class="list paylist">
				<div><span>项目名称222</span><span class="fr">成单时间：2017-12-21 12:39</span></div>
				<div><span>实际合同：￥1000.00</span></div>
				<div><span>总收入：￥1000.00</span></div>
				<div><span>已支付：￥1000.00</span></div>
			</div>
			<div class="list paylist">
				<div><span>ERP系统设计</span><span class="fr">成单时间：2017-12-21 12:39</span></div>
				<div><span>实际合同：￥1000.00</span></div>
				<div><span>总收入：￥1000.00</span></div>
				<div><span>已支付：￥1000.00</span></div>
			</div>
			<div class="list paylist">
				<div><span>ERP系统设计</span><span class="fr">成单时间：2017-12-21 12:39</span></div>
				<div><span>实际合同：￥500.00</span></div>
				<div><span>总收入：￥500.00</span></div>
				<div><span>已支付：￥500.00</span></div>
			</div> -->
		</div>
		
		<!--没有下级-->
		<!-- <div class="nothing">
			<img src="images/3-10myxxi.png" alt="" />
			<p>很抱歉，您还没有下级分销商信息</p>
			<a href="">立即发展</a>
		</div> -->
	</body>
</html>
<script type="text/javascript">
	var hasLow = false;
	$.developSecondSales(); //发展二级分销微信配置
	var type = GetQueryString('type');
	function jumpPage(id,level,userId){
		var query = '?id='+id+'&type='+type+'&userId='+userId+"&level="+level;
		var str = "salesInfo.html";
		window.location.href = str+query;
	}
		

	function payFunc(clue){
		var ifZhifu = "";
		var dot = type==1 ? "已支付" : "未支付";
		var money =  type==1 ? clue.alpayment : clue.notpay;
		return '<div><span>'+dot+'：￥'+money+'</span></div>';
	}


	function handleData(data){
		var myClue = data.myclue; //我的线索分销列表
		var myDownClue = data.mydownclue;//我的下级的线索分销列表
		var myClueHtml = "";
		var myDownClueHtml = "";
		
		if(!myClue){
			notMySales();
		}else{
			for(var i=0;i<myClue.length;i++){
				myClue[i].addtime = myClue[i].addtime ? myClue[i].addtime.slice(0,-3) : ""; //格式化日期
				
				myClueHtml +=[
					'<div class="list paylist" onclick="jumpPage(\''+myClue[i].id+'\',1,\''+myClue[i].user_id+'\')">',
						'<div><span>'+myClue[i].projectname+'</span><span class="fr">成单时间：'+myClue[i].addtime+'</span></div>',
						'<div><span>实际合同：￥'+myClue[i].actual_budget+'</span></div>',
						'<div><span>总收入：￥'+myClue[i].proportion_money+'</span></div>',
						payFunc(myClue[i]),
					'</div>'
				].join('');
			}
			$('#first').html(myClueHtml);
		}

		if(!myDownClue){
			notSecondSales();
		}else{
			for(var i=0;i<myDownClue.length;i++){
				myDownClue[i].addtime = myDownClue[i].addtime ? myDownClue[i].addtime.slice(0,-3) :''; //格式化日期
				myDownClueHtml +=[
					'<div class="list paylist" onclick="jumpPage(\''+myDownClue[i].id+'\',2,\''+myDownClue[i].user_id+'\')">',
						'<div><span>'+myDownClue[i].projectname+'</span><span class="fr">成单时间：'+myDownClue[i].addtime+'</span></div>',
						'<div><span>实际合同：￥'+myDownClue[i].actual_budget+'</span></div>',
						'<div><span>总收入：￥'+myDownClue[i].proportion_money+'</span></div>',
						payFunc(myDownClue[i]),
					'</div>'
				].join('');
			}
			$('#second').html(myDownClueHtml);
		}
	}

	function notMySales(){
		var html = [
			'<div class="nothing">',
				'<img src="images/3-10myxxi.png" />',
				'<p>很抱歉，您还没有发布线索!</p>',
			'</div>'
		].join('');
		$('#first').html(html);
	}

	function notSecondSales() {
		var html = ""
		if (hasLow) {
			html = [
				'<div class="nothing">',
					'<img src="images/3-10myxxi.png" />',
					'<p>很抱歉，您的下级还没有发布线索</p>',
				'</div>'
			].join('');
		} else {
			html = [
				'<div class="nothing">',
					'<img src="images/3-10myxxi.png" />',
					'<p>很抱歉，您还没有下级分销商信息</p>',
					'<a href="javascript:;" class="shareBtn">立即发展</a>',
				'</div>'
			].join('');
		}

		$('#second').html(html);
		alert($('#second').html())
	}


	//type=1 是已经支付 type=2是未支付
	function excuteAjax(type){
		if(type==1){ 
			$.ajax({
		        url: 'http://yichuanglian.huimor.com/index/clueDetail',
		        type:'get',
		        dataType:'json',
		        xhrFields:{  
					withCredentials:true  
				},  
		        success:function(data){
		        	if(isLogin(data)){
		        		var data=data.data;
		        		handleData(data);
		        	}
		        }
			});
		} else {
			$.ajax({
		        url: 'http://yichuanglian.huimor.com/index/notDockingDetail',
		        type:'get',
		        dataType:'json',
		        xhrFields:{  
					withCredentials:true
				},  
		        success:function(data){
		        	if(isLogin(data)){
		        		var data=data.data;
		        		handleData(data);
		        	}
		        }
			});
		}
	}


	$(function(){
		$.ajax({
			url:"http://yichuanglian.huimor.com/index/getmydowns",
			type:'get',
	        dataType:'json',
	        xhrFields:{  
				withCredentials:true
			},  
			success:function(data){
	        	if(isLogin(data)){
	        		if(data.data){ //证明有下级
	        			hasLow = true;
	        		} else { //没有下级
	        			hasLow = true;
	        		}
	        		excuteAjax(type);
	        	}
	        }
		});
		
		$('.tab_div div').click(function(){
			var index=$(this).index();
			var id=$(this).data('id');
			$(this).addClass('active').siblings().removeClass('active');
			$('.model').hide();
			$('#'+id).show();
		})
	});
</script>
